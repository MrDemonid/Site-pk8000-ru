databaseChangeLog:
  - changeSet:
      id: product-schema-1
      author: andrey
      changes:
        - createTable:
            tableName: products
            schemaName: catalog_db
            tableOptions: "ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci"
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: name
                  type: VARCHAR(128)
                  constraints:
                    nullable: false
              - column:
                  name: short_description
                  type: VARCHAR(256)
              - column:
                  name: category_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_products_category
                    references: categories(id)
                    onDelete: RESTRICT
                    onUpdate: CASCADE
              - column:
                  name: create_at
                  type: DATETIME
                  defaultValueComputed: CURRENT_TIMESTAMP
                  constraints:
                    nullable: false
        - createIndex:
            tableName: products
            indexName: idx_products_category
            columns:
              - column:
                  name: category_id

  - changeSet:
      id: product-images-schema-1
      author: andrey
      changes:
        - createTable:
            tableName: product_images
            schemaName: catalog_db
            tableOptions: "ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci"
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: file_name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: version
                  type: BIGINT
                  defaultValueNumeric: 1
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_product_images_product
                    references: products(id)
                    onDelete: CASCADE
                    onUpdate: CASCADE
        - createIndex:
            indexName: idx_product_images_product_id
            tableName: product_images
            columns:
              - column:
                  name: product_id

  - changeSet:
      id: product-archives-schema-1
      author: andrey
      changes:
        - createTable:
            tableName: product_archives
            schemaName: catalog_db
            tableOptions: "ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci"
            columns:
              - column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
                    nullable: false
              - column:
                  name: file_name
                  type: VARCHAR(255)
                  constraints:
                    nullable: false
              - column:
                  name: version
                  type: BIGINT
                  defaultValueNumeric: 1
                  constraints:
                    nullable: false
              - column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    nullable: false
                    foreignKeyName: fk_product_archives_product
                    references: products(id)
                    onDelete: CASCADE
                    onUpdate: CASCADE
        - createIndex:
            indexName: idx_product_archives_product_id
            tableName: product_archives
            columns:
              - column:
                  name: product_id
