# üåê pk8000.ru ‚Äî –æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç

–≠—Ç–æ **–æ—Ç–∫—Ä—ã—Ç—ã–π –ø—Ä–æ–µ–∫—Ç** —Å–∞–π—Ç–∞ [pk8000.ru](https://pk8000.ru).

–ü—Ä–æ–µ–∫—Ç —Å–æ–∑–¥–∞–Ω –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è –Ω–∞–≤—ã–∫–æ–≤, –ø—Ä–æ–±—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π –∏ –ø—Ä–æ—Å—Ç–æ –∏–∑ –ª—é–±–≤–∏ –∫ —Å–≤–æ–µ–º—É –ø–µ—Ä–≤–æ–º—É –∫–æ–º–ø—å—é—Ç–µ—Ä—É –ü–ö8000 "–°—É—Ä–∞".  

–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª—ã –ø—Ä–æ–µ–∫—Ç–∞, —Å–æ–±–ª—é–¥–∞—Ç—å —É—Å–ª–æ–≤–∏—è –ª–∏—Ü–µ–Ω–∑–∏–∏ –∏ –≤–Ω–æ—Å–∏—Ç—å —É–ª—É—á—à–µ–Ω–∏—è —á–µ—Ä–µ–∑ `Pull Request`.

---

## üìö –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **Backend:** Spring Boot 3.5, Spring Security, Spring Data Jpa
- **Frontend:** Thymeleaf, JavaScript, flexmark
- **Database:** MySQL 8.0
- **Migrations:** Liquibase
- **Auth:** Keycloak (OIDC, Realm –¥–ª—è auth.pk8000.ru)
- **Server:** Nginx (reverse proxy + SSL via Let's Encrypt)
- **Runtime:** JDK 21
- **Dev environment:** Docker Compose

---

## üß† –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

- AJAX-–Ω–∞–≤–∏–≥–∞—Ü–∏—è –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤–ª–æ–∂–µ–Ω–Ω—ã—Ö –º–µ–Ω—é (—á–µ—Ä–µ–∑ Thymeleaf-—Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã)
- –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ Markdown –≤ HTML —á–µ—Ä–µ–∑ flexmark
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ —á–µ—Ä–µ–∑ Keycloak
- Liquibase-–º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î
- HTTPS –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–∫—Å–∏ —á–µ—Ä–µ–∑ Nginx + Let's Encrypt
- –ì–æ—Ç–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –≤ Docker

---

## üåê –°–∞–π—Ç

üîó [https://pk8000.ru](https://pk8000.ru)

- –û—Å–Ω–æ–≤–Ω–æ–π —Å–∞–π—Ç: [https://pk8000.ru](https://pk8000.ru)
- –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏: [https://auth.pk8000.ru](https://auth.pk8000.ru)

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

content/... # –∫–æ–Ω—Ç–µ–Ω—Ç —Å–∞–π—Ç–∞ (–º–µ–Ω—é, —Å—Ç–∞—Ç–∏—á–Ω—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã, —Ñ–∞–π–ª—ã –∏ —Ç–¥.)
src/  
‚îú‚îÄ main/  
‚îÇ ‚îú‚îÄ java/ru/pk8000/... # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã, —Å–µ—Ä–≤–∏—Å—ã, —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏  
‚îÇ ‚îú‚îÄ resources/  
‚îÇ ‚îÇ ‚îú‚îÄ templates/ # HTML-—à–∞–±–ª–æ–Ω—ã (Thymeleaf)  
‚îÇ ‚îÇ ‚îú‚îÄ static/ # JS, CSS, –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è  
‚îÇ ‚îÇ ‚îú‚îÄ db/changelog/ # –°–∫—Ä–∏–ø—Ç—ã Liquibase  
‚îÇ ‚îÇ ‚îî‚îÄ application.yml # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è  
‚îî‚îÄ test/... # –¢–µ—Å—Ç—ã  
tools/... # docker-compose.yml –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ dev-—Å—Ä–µ–¥—ã.


---

## ‚öôÔ∏è –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –ª–æ–∫–∞–ª—å–Ω–æ (—á–µ—Ä–µ–∑ Docker Compose)

–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –ø–∞–ø–∫—É `./tools/pk8000-docker-container`.

### 1Ô∏è‚É£ –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä MySql.
–ó–∞–ø—É—Å–∫–∞–µ–º:
```shell
docker-compose up -d  
```

### 2Ô∏è‚É£ –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∫ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–∏ —Å–∫—Ä–∏–ø—Ç—ã.
–ò–Ω–æ–≥–¥–∞ init.sql –Ω–µ –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é. –ü–æ—ç—Ç–æ–º—É, –ª—É—á—à–µ –ø—Ä–æ–¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ. –ó–∞—Ö–æ–¥–∏–º –≤ mysql (exec):
```shell
mysql -u root -p
```
–í–≤–æ–¥–∏–º –ø–∞—Ä–æ–ª—å –∏–∑ MYSQL_ROOT_PASSWORD –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º, –≤—Å–µ –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç:
```shell
SELECT user, host FROM mysql.user;
```
–ï—Å–ª–∏ –∫–∞–∫–æ–≥–æ –Ω–µ—Ç, —Ç–æ –¥–æ–±–∞–≤–ª—è–µ–º, –∫–∞–∫ –≤ `init.sql`.  
–û–±—ã—á–Ω–æ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è keycloak@localhost, –∞ –æ–Ω –Ω–∞–º –ø–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è.

### 3Ô∏è‚É£ –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Keycloak.
```shell
docker-compose --profile manual up -d keycloak
```
–ò –∂–¥–µ–º –≤ –∫–æ–Ω—Å–æ–ª–∏ –¥–æ–∫–µ—Ä–∞ –ø–æ—è–≤–ª–µ–Ω–∏—è –Ω–∞–¥–ø–∏—Å–∏:
```shell
WARN  [org.keycloak.quarkus.runtime.KeycloakMain] (main) Running the server in development mode. DO NOT use this configuration in production.
```

### 4Ô∏è‚É£ –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è Keycloak.
–ó–∞—Ö–æ–¥–∏–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä Keycloak (exec):
```shell
mkdir /opt/keycloak/data/import
```
–ò–∑ IDEA:
```shell
docker cp ./site-pk8000-ru-realm-realm.json keycloak-site-pk8000:/opt/keycloak/data/import/site-pk8000-ru-realm-realm.json
```
–ò –∏–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∑–∞–ø—É—Å–∫–∞–µ–º –∏–º–ø–æ—Ä—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫:
```shell
/opt/keycloak/bin/kc.sh import --dir=/opt/keycloak/data/import --override true --features=scripts
```
Keycloak –≥–æ—Ç–æ–≤. –ñ–µ–ª–∞—Ç–µ–ª—å–Ω–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –µ–≥–æ –∏ mysql, –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –Ω–µ–¥–æ—Ä–∞–∑—É–º–µ–Ω–∏–π.

–î–∞–ª–µ–µ, –∑–∞—Ö–æ–¥–∏–º –≤ UI Keycloak (localhost:8080) –∏ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ realm: `site-pk8000-ru-realm`,
–∏ –∫–ª–∏–µ–Ω—Ç–∞: `client_pk8000_ru_id` –≤ —ç—Ç–æ–º realm.

–ó–∞—Ö–æ–¥–∏–º –≤ `Clients->client_pk8000_ru_id->Credentials` –∏ –∫–æ–ø–∏—Ä—É–µ–º `ClientSecret`. –î–∞–ª–µ–µ,
–ª–∏–±–æ –ø–æ–º–µ—â–∞–µ–º —ç—Ç–æ –∑–Ω–∞—á–µ–Ω–∏–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è `PK8000_CLIENT_SECRET`, –ª–∏–±–æ
–ø—Ä–æ–ø–∏—Å—ã–≤–∞–µ–º –≤ `application.yml`:   
`spring.security.oauth2.client.registration.client-pk8000-ru-id.client-secret`

–ù–∞ —ç—Ç–æ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞. –ú–æ–∂–Ω–æ –∑–∞–ø—É—Å–∫–∞—Ç—å –ø—Ä–æ–≥—Ä–∞–º–º—É.
–ü—Ä–∏ –ø–µ—Ä–≤–æ–º —Å—Ç–∞—Ä—Ç–µ Liquibase —Å–æ–∑–¥–∞—Å—Ç –≤—Å–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã.  

---

## üß∞ –°–±–æ—Ä–∫–∞ –∏ –ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫.

```shell
./mvnw clean package -DskipTests
cp -r content target/
java -jar target/site-pk8000-ru-0.0.1-SNAPSHOT.jar
```

---

## üìñ –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ –ª–∏—Ü–µ–Ω–∑–∏–µ–π [MIT](LICENSE).

---

üí¨ –û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å

–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è, –±–∞–≥-—Ä–µ–ø–æ—Ä—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–ª—è—Ç—å –≤ —Ä–∞–∑–¥–µ–ª–µ [Issues](https://github.com/MrDemonid/Site-pk8000-ru/issues)
